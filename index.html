<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vision Pro AR Clone - Hand Tracking</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>

    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.1);
            --blur: blur(25px);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; overflow: hidden;
            font-family: -apple-system, system-ui, sans-serif;
        }

        /* –°—Ç–µ—Ä–µ–æ-–≤–∏–¥ (–¥–≤–∞ —ç–∫—Ä–∞–Ω–∞) */
        #main-wrapper {
            display: flex;
            width: 200vw; /* –ö–æ–Ω—Ç–µ–Ω—Ç –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è */
            height: 100vh;
            position: relative;
        }

        .view-half {
            width: 50vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        /* –ö–∞–º–µ—Ä–∞ –∫–∞–∫ –∑–∞–¥–Ω–∏–π —Ñ–æ–Ω */
        .camera-background {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            z-index: 1;
            transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª—å–Ω–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
        }

        /* –°–ª–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        /* –ò–∫–æ–Ω–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            pointer-events: auto;
        }

        .app-item {
            width: 100px;
            height: 100px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.2s;
            color: white;
            font-size: 12px;
        }

        .app-item.hovered {
            transform: scale(1.15) translateZ(50px);
            border-color: #007AFF;
            box-shadow: 0 0 20px rgba(0,122,255,0.5);
        }

        /* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å–æ—Ä (–æ—Ç —Ä—É–∫–∏) */
        .hand-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            border: 2px solid #007AFF;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 0 15px #007AFF;
            display: none;
        }

        /* –û–∫–Ω–∞ */
        .window {
            position: absolute;
            top: 20%; width: 80%; height: 50%;
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(40px);
            border-radius: 30px;
            display: none;
            padding: 20px;
            color: white;
            z-index: 10;
        }

        #debug {
            position: fixed; top: 10px; left: 10px; color: lime; z-index: 1000; font-size: 10px;
        }
    </style>
</head>
<body>

    <div id="debug">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI —Ç—Ä–µ–∫–∏–Ω–≥–∞...</div>

    <div id="main-wrapper">
        <div class="view-half" id="left-view">
            <video id="input_video" class="camera-background" playsinline></video>
            <div class="ui-layer">
                <div class="grid" id="grid-l">
                    <div class="app-item" data-id="safari"><span>üåê</span><br>Safari</div>
                    <div class="app-item" data-id="photos"><span>üñºÔ∏è</span><br>Photos</div>
                    <div class="app-item" data-id="music"><span>üéµ</span><br>Music</div>
                </div>
                <div class="window" id="win-l">–ö–ª–∏–∫ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ.</div>
            </div>
            <div class="hand-dot" id="dot-l"></div>
        </div>

        <div class="view-half" id="right-view">
            <video id="input_video_r" class="camera-background" playsinline></video>
            <div class="ui-layer">
                <div class="grid" id="grid-r">
                    <div class="app-item" data-id="safari"><span>üåê</span><br>Safari</div>
                    <div class="app-item" data-id="photos"><span>üñºÔ∏è</span><br>Photos</div>
                    <div class="app-item" data-id="music"><span>üéµ</span><br>Music</div>
                </div>
                <div class="window" id="win-r">–ö–ª–∏–∫ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ.</div>
            </div>
            <div class="hand-dot" id="dot-r"></div>
        </div>
    </div>

    <script>
        const videoElement = document.getElementById('input_video');
        const debug = document.getElementById('debug');
        
        let hoveredApp = null;
        let hoverStartTime = 0;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                // –ë–µ—Ä–µ–º –∫–æ–Ω—á–∏–∫ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞ (Landmark 8)
                const indexFinger = hand[8];
                
                // –ü–µ—Ä–µ–≤–æ–¥–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø–∏–∫—Å–µ–ª–∏ (–∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º X, —Ç–∞–∫ –∫–∞–∫ –∫–∞–º–µ—Ä–∞ –æ—Ç–∑–µ—Ä–∫–∞–ª–µ–Ω–∞)
                const x = (1 - indexFinger.x) * window.innerWidth / 2;
                const y = indexFinger.y * window.innerHeight;

                updateCursors(x, y);
                checkInteraction(x, y);
                debug.innerText = "–†—É–∫–∞ –≤ –∫–∞–¥—Ä–µ. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–∞–ª—å—Ü–µ–º.";
            } else {
                debug.innerText = "–†—É–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–∫–∞–∂–∏—Ç–µ –ª–∞–¥–æ–Ω—å –∫–∞–º–µ—Ä–µ.";
            }
        }

        function updateCursors(x, y) {
            const dots = [document.getElementById('dot-l'), document.getElementById('dot-r')];
            dots.forEach(dot => {
                dot.style.display = 'block';
                dot.style.left = x + 'px';
                dot.style.top = y + 'px';
            });
        }

        function checkInteraction(x, y) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –≤ –∏–∫–æ–Ω–∫–∏ (–Ω–∞ –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ, —Ç–∞–∫ –∫–∞–∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã)
            const elements = document.querySelectorAll('.app-item');
            let found = false;

            elements.forEach(el => {
                const rect = el.getBoundingClientRect();
                // –¢–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –¥–≤–∞ —ç–∫—Ä–∞–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–¥–Ω–æ–≥–æ
                const normalizedX = x; 
                
                if (x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
                    found = true;
                    if (hoveredApp !== el) {
                        hoveredApp = el;
                        hoverStartTime = Date.now();
                        el.classList.add('hovered');
                    } else {
                        // –ï—Å–ª–∏ –¥–µ—Ä–∂–∏–º –ø–∞–ª–µ—Ü 1.5 —Å–µ–∫—É–Ω–¥—ã - "–∫–ª–∏–∫–∞—è"
                        if (Date.now() - hoverStartTime > 1500) {
                            openWindow();
                        }
                    }
                } else {
                    el.classList.remove('hovered');
                }
            });

            if (!found) hoveredApp = null;
        }

        function openWindow() {
            document.getElementById('win-l').style.display = 'block';
            document.getElementById('win-r').style.display = 'block';
            setTimeout(() => {
                document.getElementById('win-l').style.display = 'none';
                document.getElementById('win-r').style.display = 'none';
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaPipe
        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
                // –î—É–±–ª–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫ –Ω–∞ –≤—Ç–æ—Ä–æ–π –≥–ª–∞–∑
                document.getElementById('input_video_r').srcObject = videoElement.srcObject;
            },
            width: 640,
            height: 480
        });
        
        camera.start();

    </script>
</body>
</html>
